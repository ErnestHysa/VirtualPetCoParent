# Virtual Pet Co-Parent - Design Document

**Date:** 2025-01-10
**Status:** Approved

---

## Overview

A wholesome, low-pressure shared digital pet app where couples adopt and raise one adorable creature together across distance. The pet lives in a synced virtual home with joint care tasks, personality development, and milestone evolutions.

---

## 1. Technology Stack

| Layer | Technology | Rationale |
|-------|-----------|-----------|
| Frontend | React Native (Expo v52) + TypeScript | Cross-platform, excellent DX, mature ecosystem |
| UI | NativeWind v4 + Reanimated | Tailwind for RN, fluid animations |
| State | Zustand + persist middleware | Lightweight, simple API, great TypeScript |
| Navigation | Expo Router | File-based routing, deep linking |
| Backend | Supabase (PostgreSQL, Real-time, Auth) | Real-time sync, RLS, generous free tier |
| Push | Expo Notifications + Supabase | Device token management, rich notifications |
| Storage | Supabase Storage | Pet images, assets, backups |

---

## 2. Project Structure

```
VirtualPetCoParent/
├── app/                    # Expo Router pages
│   ├── (auth)/            # Auth stack
│   │   ├── onboarding.tsx
│   │   ├── signup.tsx
│   │   └── pair.tsx
│   ├── (tabs)/            # Main tabs
│   │   ├── home.tsx       # Pet display
│   │   ├── care.tsx       # Feed/play/walk
│   │   ├── games.tsx      # Mini-games
│   │   └── settings.tsx
│   ├── milestones.tsx
│   └── _layout.tsx
├── components/            # Reusable UI
│   ├── ui/               # Base components (Button, Card, etc.)
│   ├── pet/              # Pet-related components
│   └── games/            # Mini-game components
├── hooks/                 # Custom hooks
├── stores/                # Zustand stores
├── lib/                   # Supabase client, utilities
├── services/              # Business logic
├── types/                 # TypeScript types
├── constants/             # Design tokens, config
└── assets/                # Images, fonts, sprites
```

---

## 3. Database Schema

```sql
-- Extends Supabase auth
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users,
  username TEXT UNIQUE,
  partner_id UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE couples (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user1_id UUID REFERENCES profiles(id),
  user2_id UUID REFERENCES profiles(id),
  pet_id UUID REFERENCES pets(id),
  start_date DATE DEFAULT CURRENT_DATE,
  milestones_unlocked JSONB DEFAULT '{}'
);

CREATE TABLE pets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID REFERENCES couples(id),
  species TEXT NOT NULL, -- 'dragon', 'cat', 'fox', 'puppy'
  color TEXT NOT NULL,
  name TEXT NOT NULL,
  current_stage TEXT DEFAULT 'egg', -- egg, baby, child, teen, adult, elder
  hunger INTEGER DEFAULT 80 CHECK (hunger >= 0 AND hunger <= 100),
  happiness INTEGER DEFAULT 80 CHECK (happiness >= 0 AND happiness <= 100),
  energy INTEGER DEFAULT 80 CHECK (energy >= 0 AND energy <= 100),
  personality_type JSONB DEFAULT '{}',
  xp INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE care_actions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  pet_id UUID REFERENCES pets(id),
  user_id UUID REFERENCES profiles(id),
  action_type TEXT NOT NULL, -- 'feed', 'play', 'walk', 'pet'
  timestamp TIMESTAMPTZ DEFAULT NOW(),
  bonus_points INTEGER DEFAULT 0
);

CREATE TABLE milestones (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  couple_id UUID REFERENCES couples(id),
  milestone_type TEXT NOT NULL,
  achieved_at TIMESTAMPTZ DEFAULT NOW(),
  evolution_unlocked TEXT
);

CREATE TABLE inventory (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  item_type TEXT NOT NULL,
  is_equipped BOOLEAN DEFAULT FALSE
);
```

---

## 4. Real-Time Sync Strategy

- Subscribe to `pets` table via Supabase Realtime
- Care action → write to `care_actions` → server function updates pet stats
- All connected clients receive update instantly
- Optimistic UI with rollback on failure
- Conflict: Last-write-wins for simple stats
- Cooldown: 5 min between same action type per user

---

## 5. Design System - "Whimsical Premium"

### Colors
```javascript
const colors = {
  primary: {
    rose: '#E8B4B8',
    lavender: '#C5B9CD',
    sky: '#A7C7E7',
  },
  background: {
    light: '#FAF8F5',
    dark: '#1A1A2E',
  },
  semantic: {
    hunger: '#FFB5A7',
    happiness: '#FFE58F',
    energy: '#B5EAD7',
  },
}
```

### Typography
- Scale: 12, 14, 17, 20, 24, 32 (Apple's system)
- Display: 600 weight, rounded sans-serif
- Body: System font, line-height 1.5

### Motion
- Default spring: `damping: 15, stiffness: 150`
- Stagger reveals: 100ms offsets
- Every touch: Haptic + visual feedback

### Materials
- Glassmorphism: `expo-blur`, 20-40% transparency
- Multi-layered shadows, warm-toned
- Hairline borders (0.5px)

---

## 6. Mini-Games

All games are 30 seconds, accessible, and reward co-op play.

| Game | Mechanic | Co-op Bonus |
|------|----------|-------------|
| Tap to Pet | Rapid tapping fills affection meter | Both playing = 1.5x |
| Swipe to Groom | Follow directional arrows | Synced swipes = combo |
| Rhythm Feed | Tap to beat, timing matters | Perfect sync = 2x |
| Fetch Together | Alternating taps | Turn timing = streak bonus |

---

## 7. Personality System

```typescript
type PersonalityTrait = {
  playful: number     // Increases with games
  calm: number        // Increases with gentle pets
  mischievous: number // Increases with irregular care
  affectionate: number // Increases with consistency
}

// Determines animations, reactions, messages
```

---

## 8. Evolution Stages

| Stage | Days Streak | Visual Change |
|-------|-------------|---------------|
| Egg | 0 | Glowing, wobbling |
| Baby | 3 | Small, large eyes |
| Child | 14 | +40% size, more expressive |
| Teen | 30 | +30% size, rebellious |
| Adult | 60 | Full size, regal |
| Elder | 100 | Wise, glowing |
| Milestone | In-person visit | Shiny variant + hearts |

---

## 9. Notifications

**Types:**
- Care reminders (both inactive >4 hours)
- Partner actions (instant)
- Mood changes
- Milestone achievements
- Daily sweet messages

**Design:**
- Rich notifications with pet thumbnail
- Action buttons: Feed Now | Play | Send Love
- Quiet hours (user-configurable, 10pm-8am default)

---

## 10. Widgets

Home/Lock screen widget showing:
- Pet avatar (small, animated if possible)
- Status pills (Hunger, Happiness, Energy)
- Quick message ("Feed me?")
- Days together counter

Updates every 5 min + on change.

---

## 11. Accessibility

- WCAG AA+ contrast ratios
- All actions playable with one hand
- Touch targets >=44px
- Colorblind-friendly palette
- Haptic + visual feedback
- Skip option with reduced rewards

---

## 12. MVP Feature Checklist

- [ ] User auth (Supabase)
- [ ] Partner pairing (code/link)
- [ ] Pet adoption (species, color, name)
- [ ] Real-time pet state sync
- [ ] Care actions (feed, play, walk)
- [ ] 4 mini-games
- [ ] Personality tracking
- [ ] Evolution system (6 stages)
- [ ] Home screen widgets
- [ ] Push notifications
- [ ] Milestone celebrations
- [ ] Customization (accessories, colors)
